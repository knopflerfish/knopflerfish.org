
<!-- osgi.jar should be set to your preferred jar containing -->
<!-- the org.osg.* APIs                                      -->
<property name     = "osgi.jar"
          location = "${topdir}/../../framework.jar"/>

<property name     = "bundle.version" 
          value    = "1.0.0"/>

<property name     = "bundle.name" 
          value    = "${ant.project.name}"/>

<property name     = "classes.out.dir" 
          location = "${topdir}/out/${ant.project.name}/classes"/>

<property name     = "jar.out.dir" 
          location = "${topdir}/jars/"/>

<property name     = "src.dir"
          location = "src"/>

<property name     = "resources.dir"
          location = "resources"/>

<property name     = "javac.target"
          value    = "1.2"/>

<property name     = "javac.source"
          value    = "1.2"/>

<property name     = "manifest.file"
          location = "all.mf"/>

<property name     = "jar.file"
          location = "${jar.out.dir}/${ant.project.name}-${bundle.version}.jar"/>

<path id="bundle.path">
  <pathelement location="${osgi.jar}"/>
  <pathelement location="${topdir}/lib/junit.jar"/>
</path>

<target name="all">
 <available file="${osgi.jar}" property="osgi.jar.present"/>
 <antcall target = "check_osgi"/>

 <antcall target = "try_bundle.custom.pre"/>
 <antcall target = "compile"/>
 <antcall target = "jar"/>
</target>

<target name="check_osgi" unless="osgi.jar.present">
  <fail message="Cannot find OSGi API jar. The 'osgi.jar' property is currently set to '${osgi.jar}"/>
</target>

 <target name        = "try_bundle.custom.pre"
         if          = "do.bundle.custom.pre">
   <antcall target = "bundle.custom.pre"/>
 </target>


<target name="compile">
  <mkdir dir="${classes.out.dir}"/>

  <javac destdir       = "${classes.out.dir}" 
           debug         = "on"
           srcdir        = "${src.dir}"
           target        = "${javac.target}"
           source        = "${javac.source}"
           includes      = "**/*.java"
  >
   <classpath>
    <path refid = "bundle.path"/>
    <path refid = "bundle.compile.path"/>
   </classpath>

  </javac>
</target>

<target name="jar">
  <mkdir dir="${jar.out.dir}"/>

  <tstamp>
   <format property = "bundle.date" 
          pattern  = "EE MMMM d yyyy, HH:mm:ss"
          locale   = "en"/>
  </tstamp>

  <jar basedir  = "${classes.out.dir}"
       jarfile  = "${jar.file}"
       manifest = "${manifest.file}"
    >
     <fileset dir = "${resources.dir}"/>

    </jar>  
</target>

<target name="clean">
  <delete file = "${jar.file}"        />
  <delete dir  = "${classes.out.dir}" />
</target>
