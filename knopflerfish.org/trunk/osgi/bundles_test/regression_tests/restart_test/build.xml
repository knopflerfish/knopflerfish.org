<?xml version="1.0"?>

<!DOCTYPE project [
  <!ENTITY bundlebuild_include  SYSTEM "../../../../ant/bundlebuild_include.xml">
]>

<project name="restart_test" default="all">

  <property name="topdir"     location=".."/>
  <property name="osgi.dir"   location="${topdir}/../.."/>
  <property name="ant.dir"    location="${osgi.dir}/../ant"/>

  <property name = "bundle.build.all"  value="false"/>
  <property name = "bundle.build.api"  value="false"/>
  <property name = "bundle.build.lib"  value="false"/>
  <property name = "bundle.build.impl" value="true"/>
  <property name = "bundle.build.doc"  value="false"/>

  <property name  = "impl.pattern"
            value = "org/knopflerfish/bundle/**"/>

  <path id = "bundle.compile.path">
  </path>

  <property name="do.bundle.custom.pre" value="true"/>

  <target name="bundle.custom.pre">
   <copy file  = "${topdir}/jars/bundleA_test-1.0.0.jar"         
         todir = "resources"/>
   <copy file  = "${topdir}/jars/bundleB_test-1.0.0.jar"         
         todir = "resources"/>
   <copy file  = "${topdir}/jars/bundleC_test-1.0.0.jar"         
         todir = "resources"/>
   <copy file  = "${topdir}/jars/bundleF_test-1.0.0.jar"         
         todir = "resources"/>
  </target>

  <property name="do.bundle.custom.post" value="true"/>
  <property name="xargs1" location="test-restart1.xargs"/>
  <property name="xargs2" location="test-restart2.xargs"/>
  <target name="bundle.custom.post">
    <property name="bundleVersionFilterTester"
	      location="${outdir}/${ant.project.name}.props"/>
    <bundle_locator replacefilterfile="${bundleVersionFilterTester}">
      <fileset dir="${osgi.dir}">
	<include name="jars/**/*.jar"/>
	<include name="bundles_test/regression_tests/jars/**/*.jar"/>
      </fileset>
    </bundle_locator>
    <copy file="${xargs1}.in" tofile="${xargs1}" overwrite="true"/>
    <replace file="${xargs1}"
	     replacefilterfile="${bundleVersionFilterTester}">
      <replacefilter token="$(OSGI_DIR)" value="${osgi.dir}"/>
    </replace>	  
    <copy file="${xargs2}.in" tofile="${xargs2}" overwrite="true"/>
    <replace file="${xargs2}"
	     replacefilterfile="${bundleVersionFilterTester}">
      <replacefilter token="$(OSGI_DIR)" value="${osgi.dir}"/>
    </replace>	  
  </target>

  &bundlebuild_include;

</project>



