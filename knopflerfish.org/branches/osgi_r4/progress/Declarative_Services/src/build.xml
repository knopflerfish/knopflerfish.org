<?xml version="1.0"?>

<!--
In order to run this with ant, this build.xml file needs to be placed in the
folder from wich the following folders are children, CustomerInfo, MyValueClient,
StockQoute, MyValueBind, MyValueLocate and SCR (or whatever we will call it)
The following structure should be followed:

ProjectFolder (the bundle.manifest should be placed here)
     |
     src (the place in witch the java files are placed)
     |
     out (the place in witch the class files are placed)
        |
        OSGI-INF (place the xml file to be used by SCR here)

All jar files will end up here:
runtime-knopflerfish/jars/
-->

<project name="Declarative Services" default="all">
  <!-- set global properties for this build -->
  <property name="runtime"  location="runtime-knopflerfish/jars/"/>

	<!-- Compile all and make all jar files -->
	<target name="all" 
		depends="init,CustomerInfo,MyValueClient,StockQuote,MyValueBind,MyValueLocate"
	/>

	<!-- Make sure that the folder runtime-knopflerfish/jars/ is pressent -->
	<target name="init">
		<mkdir dir="${runtime}"/>
	</target>

	<!-- Build and make jar for CustomerInfo -->
	<target name="CustomerInfo" 
		description = "generating the CustomerInfo"
		depends="init"
	>
		<!-- Make the out dir -->
		<mkdir dir = "CustomerInfo/out"/>
		<!-- Compile CustomerInfo -->
		<javac destdir = "CustomerInfo/out"
			debug = "on"
			srcdir = "CustomerInfo/src"
		>
		</javac>
		<!-- Create jar file of CustomerInfo -->
		<jar basedir = "CustomerInfo/out"
			jarfile = "${runtime}/CustomerInfo.jar"
			compress = "true"
			includes = "**/*"
			manifest = "CustomerInfo/bundle.manifest"
		/>
	</target>

	<!-- Build and make jar for MyValueClient -->
	<target name="MyValueClient" 
		description="generating the MyValueClient"
		depends="init"
	>
		<!-- Make the out dir -->
		<mkdir dir = "MyValueClient/out"/>
		<!-- Compile MyValueClient -->
		<javac destdir = "MyValueClient/out"
			debug = "on"
			srcdir = "MyValueClient/src"
		>
		</javac>
		<!-- Create jar file of MyValueClient -->
		<jar basedir = "MyValueClient/out"
			jarfile = "${runtime}/MyValueClient.jar"
			compress = "true"
			includes = "**/*"
			manifest = "MyValueClient/bundle.manifest"
		/>	
	</target>

	<!-- Build and make jar for StockQuote -->
	<target name="StockQuote" 
		description="generating the StockQuote"
		depends="init"
	>
		<!-- Make the out dir -->
		<mkdir dir = "StockQuote/out"/>
		<!-- Compile StockQoute -->
		<javac destdir = "StockQuote/out"
			debug = "on"
			srcdir = "StockQuote/src"
		>
		</javac>
		<!-- Create jar file of StockQoute -->
		<jar basedir = "StockQuote/out"
			jarfile = "${runtime}/StockQuote.jar"
			compress = "true"
			includes = "**/*"
			manifest = "StockQuote/bundle.manifest"
		/>
	</target>

	<!-- Build and make jar for MyValueBind -->
	<target name="MyValueBind" 
		description="generating the MyValueBind"
		depends="init,StockQuote,CustomerInfo"
	>
		<!-- Make the out dir -->
		<mkdir dir = "MyValueBind/out"/>
		<!-- Compile MyValueBind -->
		<javac destdir = "MyValueBind/out"
			debug = "on"
			srcdir = "MyValueBind/src"
		>
			<!-- The path to needed classes -->
			<classpath>
				<pathelement 
					location = "CustomerInfo/out/com/isv/service/customerinfo"
				/>
				<pathelement 
					location = "StockQuote/out/com/isv/service/stockquote"
				/>
			</classpath>
		</javac>
		<!-- Create jar file of MyValueBind -->
		<jar basedir = "MyValueBind/out"
			jarfile = "${runtime}/MyValueBind.jar"
			compress = "true"
			includes = "**/*"
			manifest = "MyValueBind/bundle.manifest"
		/>	
	</target>

	<!-- Build and make jar for MyValueLocate -->
	<target name="MyValueLocate" 
		description="generating the MyValueLocate"
		depends="init,StockQuote,CustomerInfo"
	>
		<!-- Make the out dir -->
		<mkdir dir = "MyValueLocate/out"/>
		<!-- Compile MyValueLocate -->
		<javac destdir = "MyValueLocate/out"
			debug = "on"
			srcdir = "MyValueLocate/src"
		>
			<!-- The path to needed classes -->
			<classpath>
				<pathelement 
					location = "CustomerInfo/out/com/isv/service/customerinfo"
				/>
				<pathelement 
					location = "StockQuote/out/com/isv/service/stockquote"
				/>
<!-- Needs to be inserted in order to compile
				<pathelement 
					location = "SCR/out/"
				/>
-->
			</classpath>
		</javac>
		<!-- Create jar file of MyValueLocate -->
		<jar basedir = "MyValueLocate/out"
			jarfile = "${runtime}/MyValueLocate.jar"
			compress = "true"
			includes = "**/*"
			manifest = "MyValueLocate/bundle.manifest"
		/>		
	</target>
</project>


