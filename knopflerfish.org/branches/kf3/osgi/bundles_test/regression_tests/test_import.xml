<?xml version="1.0" encoding="UTF-8"?>

<project name="test_import" default="all">

  <!-- Common definitions for all test bundles. -->
  <dirname  property="topdir" file="${ant.file.test_import}"/>
  <property name="osgi.dir"   location="${topdir}/../.."/>
  <property name="ant.dir"    location="${osgi.dir}/../ant"/>
  <property name="jars.dir"   location="${topdir}/jars"/> 

  <!-- Base URLs for test-case xargs files. Must not use ${jars.dir},
       ${osgi.dir} here since that would result in absolute paths in
       the base URL which is not good when the xargs file is used in
       the distribution. -->
  <property name="tests.base.urls"
	    value="file:bundles_test/regression_tests/jars/;file:jars/"/>

  <!-- Filters "${xargs}.in" -> "${xargs}" -->
  <target name="test-xargs">
    <fail unless="xargs.file" message="xargs.file must be set."/>
    <fail unless="bundleVersionFilterTester"
	  message="bundleVersionFilterTester must be set."/>

    <bundle_locator replacefilterfile="${bundleVersionFilterTester}">
      <fileset dir="${jars.dir}">
	<include name="**/*.jar"/>
      </fileset>
      <fileset dir="${osgi.dir}/jars">
	<include name="**/*.jar"/>
      </fileset>
    </bundle_locator>
    <copy file="${xargs.file}.in" tofile="${xargs.file}" overwrite="true"/>
    <replace file="${xargs.file}"
	     replacefilterfile="${bundleVersionFilterTester}">
      <replacefilter token="$(OSGI_DIR)" value="${osgi.dir}"/>
      <replacefilter token="$(JAR_PREFIX)" value="${tests.base.urls}"/>
    </replace>	  
  </target>


</project>
 
